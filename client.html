<html>

<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
	<script src="http://cdn.sockjs.org/sockjs-0.3.min.js"></script>
	<link rel="stylesheet" href="http://flip.hr/css/bootstrap.min.css">
</head>

<body style="margin:100">
		<div id="terminal-1" class="tab-pane active">
			<pre id="output" style="height:300px; overflow:auto;"></pre>

			<div class="row-fluid">	
				<div class="span6">
					<form id="myForm" class="form-inline" onsubmit="return false;">
						<input type="text" class="input-large" style="width:70%" name="command" placeholder="Enter Command" autocomplete="off">
						<button id="execute" class="btn">Go!</button>
					</form>

				</div>
			</div>
		</div>



		


<script>
	$(document).ready(function(){

		$('#execute').button({disabled: true});

		
		var socket = new SockJS('http://www.codelearn.org:3000/echo');
		socket.onopen = function() {	
			console.log('open');
			$('#execute').button({disabled: false});
		};

		socket.onmessage = function(e) {				
					
			
			$('#output').append(colorReplace(e.data,true));

			var end_of_output = /(\$|>)\s*$/;
	
			if(end_of_output.test(e.data)){		
				$('#execute').button({disabled: false});	
			};

		};

		socket.onclose = function() {
			console.log('close');
			$('#execute').button({disabled: true});
		};
		
		$("#myForm").submit(function(){
			if($('#execute').is(':disabled') == false){
				$('#execute').click();
			};
		});		

		$("#execute").click(function(){
			console.log('button clicked!!!');			
			command = $("input[name='command']").val();			
			socket.send(command);
			$("input[name='command']").val('');
			$('#execute').button({disabled: true});
		});

		function colorReplace( input, replace ) {
        
			var span = "<span style='";
			var color = "color: ";
			var bold = " font-weight: bold;";
			var underline = " text-decoration: underline;";
			var span_fin = "'>";			
			var span_end = "</span>";
			var reset = /\033\[0+m/;
		
			input = input.replace(reset,"<span>");
						
			var replaceColors = {
            "31" : "red;",
            "01;31" : "red;" + bold,

            "32" : "green;",
            "01;32" : "green;" + bold,

            "33" : "yellow;",
            "01;33" : "yellow;" + bold,

            "34" : "blue;",
            "01;34" : "blue;" + bold,

            "35" : "purple;",
            "01;35" : "purple;" + bold,

            "36" : "cyan;",
            "01;36" : "cyan;" +bold,
						"04;36" : "cyan;" +underline,

            "37" : "white;",
            "01;37" : "white;" +bold,

            "01;30" : bold,
						"01" : bold

        };
				

        for( k in replaceColors )
        {
            var re = new RegExp( "\\033\\[" + k + "m", "g" );
						var re_str  = span_end  + span + color + replaceColors[ k ] + span_fin;
            input = input.replace( re,re_str);
        };

				input = input.replace(/\033\[0+m/g,span_end);			
        
				return input;
    };		
		
	});
</script>
</body>
</html>
